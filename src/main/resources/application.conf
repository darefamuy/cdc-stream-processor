# =============================================================================
# AB Bank Kafka Streams Application Configuration
# All values can be overridden via:
#   System properties:  -Dkafka.bootstrap-servers=...
#   Environment vars:   KAFKA_BOOTSTRAP_SERVERS=... (mapped automatically by Typesafe Config)
# =============================================================================

kafka {
  bootstrap-servers       = "localhost:9092"
  bootstrap-servers       = ${?KAFKA_BOOTSTRAP_SERVERS}

  schema-registry-url     = "http://localhost:8081"
  schema-registry-url     = ${?SCHEMA_REGISTRY_URL}

  streams {
    application-id        = "cdc-stream-processor-v1"
    application-id        = ${?STREAMS_APPLICATION_ID}

    client-id             = "cdc-stream-processor-client"
    client-id             = ${?STREAMS_CLIENT_ID}

    num-stream-threads    = 4
    num-stream-threads    = ${?STREAMS_NUM_THREADS}

    commit-interval-ms    = 5000
    commit-interval-ms    = ${?STREAMS_COMMIT_INTERVAL_MS}

    # 10 MB record cache per thread for buffering aggregation results
    cache-max-bytes-buffering = 10485760
    cache-max-bytes-buffering = ${?STREAMS_CACHE_MAX_BYTES}
  }
}

abbank {
  thresholds {
    # Alert threshold for a single transaction (Nigerian Naira)
    high-value-ngn                = 500000
    high-value-ngn                = ${?ABBANK_HIGH_VALUE_THRESHOLD_NGN}

    # Velocity fraud: N or more transactions within the window triggers alert
    velocity-max-transactions     = 5
    velocity-max-transactions     = ${?ABBANK_VELOCITY_MAX_TXN}

    velocity-window-seconds       = 60
    velocity-window-seconds       = ${?ABBANK_VELOCITY_WINDOW_SEC}

    # Account dormancy gap in days (session window inactivity gap)
    dormancy-days                 = 30
    dormancy-days                 = ${?ABBANK_DORMANCY_DAYS}

    # Daily spend alert threshold (NGN)
    daily-spend-alert-ngn         = 1000000
    daily-spend-alert-ngn         = ${?ABBANK_DAILY_SPEND_ALERT_NGN}
  }

  health {
    port = 8080
    port = ${?HEALTH_PORT}
  }
}
